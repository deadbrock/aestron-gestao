<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout}">
<head>
    <th:block th:fragment="titulo">RelatÃ³rios AvanÃ§ados - AESTRON</th:block>
</head>
<body>
    <th:block th:fragment="content">

    <div class="container-fluid p-4 fade-in">
        <nav aria-label="breadcrumb" class="breadcrumb-modern">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="bi bi-house-door-fill"></i> Dashboard</a></li>
                <li class="breadcrumb-item active"><i class="bi bi-graph-up"></i> RelatÃ³rios AvanÃ§ados</li>
            </ol>
        </nav>

        <div class="page-header d-flex justify-content-between align-items-center flex-wrap">
            <h2><i class="bi bi-graph-up"></i> RelatÃ³rios AvanÃ§ados</h2>
            <button class="btn btn-light btn-lg" onclick="alert('ExportaÃ§Ã£o em desenvolvimento')">
                <i class="bi bi-download"></i> Exportar PDF
            </button>
        </div>

        <div class="card-modern mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-funnel-fill"></i> Filtros</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="fw-bold">PerÃ­odo:</label>
                        <select class="form-select" id="periodo" onchange="atualizar()" style="border-radius: 10px;">
                            <option value="7">Ãšltimos 7 dias</option>
                            <option value="30" selected>Ãšltimos 30 dias</option>
                            <option value="90">Ãšltimos 90 dias</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card-pro" style="background: linear-gradient(135deg, #0891b2 0%, #14b8a6 100%);">
                    <h6>ðŸ’° Receita</h6>
                    <h2 id="receita">R$ 0,00</h2>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card-pro" style="background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);">
                    <h6>ðŸ’¸ Despesa</h6>
                    <h2 id="despesa">R$ 0,00</h2>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card-pro" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);">
                    <h6>ðŸ“Š Lucro</h6>
                    <h2 id="lucro">R$ 0,00</h2>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card-pro" style="background: linear-gradient(135deg, #38bdf8 0%, #7dd3fc 100%);">
                    <h6>ðŸ“ˆ Margem</h6>
                    <h2 id="margem">0%</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 mb-3">
                <div class="card-modern">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-graph-up-arrow"></i> EvoluÃ§Ã£o Financeira</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="grafico" height="80"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card-modern">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-pie-chart-fill"></i> DistribuiÃ§Ã£o</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="pizza"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        let chart, pizza;
        function atualizar() {
            const dias = parseInt(document.getElementById('periodo').value);
            const receitas = [], despesas = [], labels = [];
            for (let i = dias; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                labels.push(d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                receitas.push(Math.random() * 5000 + 2000);
                despesas.push(Math.random() * 3000 + 1000);
            }
            const totRec = receitas.reduce((a, b) => a + b, 0);
            const totDesp = despesas.reduce((a, b) => a + b, 0);
            const lucro = totRec - totDesp;
            const margem = totRec > 0 ? (lucro / totRec * 100).toFixed(1) : 0;
            document.getElementById('receita').textContent = fmt.format(totRec);
            document.getElementById('despesa').textContent = fmt.format(totDesp);
            document.getElementById('lucro').textContent = fmt.format(lucro);
            document.getElementById('margem').textContent = margem + '%';
            if (chart) chart.destroy();
            chart = new Chart(document.getElementById('grafico'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Receitas', data: receitas, borderColor: '#0891b2', backgroundColor: 'rgba(17, 153, 142, 0.1)', tension: 0.4 },
                        { label: 'Despesas', data: despesas, borderColor: '#0ea5e9', backgroundColor: 'rgba(240, 147, 251, 0.1)', tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
            if (pizza) pizza.destroy();
            pizza = new Chart(document.getElementById('pizza'), {
                type: 'doughnut',
                data: {
                    labels: ['Fornecedores', 'Impostos', 'Operacional', 'Marketing'],
                    datasets: [{ data: [30, 20, 25, 25], backgroundColor: ['#1e40af', '#0891b2', '#0ea5e9', '#38bdf8'] }]
                }
            });
        }
        document.addEventListener('DOMContentLoaded', atualizar);
    </script>
</body>
</html>

    </th:block>
</body>
</html>